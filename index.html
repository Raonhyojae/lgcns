<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LG CNS í†µí•© ë¬¼í’ˆê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      
      body { 
          font-family: 'Malgun Gothic', sans-serif; 
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          color: white;
      }
      
      .container { 
          max-width: 1200px; 
          margin: 0 auto; 
          padding: 20px;
      }

      h1 { 
          text-align: center;
          margin-bottom: 30px; 
          font-size: 28px; 
          font-weight: bold;
          color: #fff;
          text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
          background: rgba(255,255,255,0.1);
          padding: 20px;
          border-radius: 15px;
          backdrop-filter: blur(10px);
      }

      .mode-tabs {
          display: flex;
          justify-content: center;
          margin-bottom: 30px;
          gap: 10px;
      }

      .mode-tab {
          padding: 15px 30px;
          background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
          color: rgba(255,255,255,0.8);
          border: 2px solid rgba(255,255,255,0.2);
          border-radius: 30px;
          cursor: pointer;
          font-size: 16px;
          font-weight: 700;
          transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
          position: relative;
          overflow: hidden;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }

      .mode-tab:hover {
          transform: translateY(-3px);
          box-shadow: 0 10px 30px rgba(0,0,0,0.3);
          border-color: rgba(255,255,255,0.4);
      }

      .mode-tab.active {
          background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
          color: white;
          border-color: rgba(255,255,255,0.6);
          box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
          transform: translateY(-2px);
      }

      .upload-section { 
          text-align: center; 
          margin-bottom: 30px; 
          padding: 20px; 
          background: rgba(255,255,255,0.1);
          border-radius: 15px;
          backdrop-filter: blur(10px);
      }
      
      .file-input-wrapper { 
          position: relative; 
          display: inline-block; 
          margin-bottom: 15px;
      }
      
      .file-input-wrapper input[type=file] { 
          position: absolute; 
          opacity: 0; 
          width: 100%; 
          height: 100%; 
          cursor: pointer; 
      }
      
      .file-input-label { 
          display: inline-block; 
          padding: 12px 25px; 
          background: rgba(255,255,255,0.2);
          color: white; 
          border-radius: 25px; 
          cursor: pointer; 
          font-size: 16px; 
          transition: all 0.3s ease;
          border: 2px solid rgba(255,255,255,0.3);
      }
      
      .file-input-label:hover { 
          background: rgba(255,255,255,0.3);
      }

      .upload-info {
          margin-top: 10px;
          font-size: 14px;
          color: rgba(255,255,255,0.8);
      }

      .file-rules {
          margin-top: 15px;
          padding: 15px;
          background: rgba(255,255,255,0.1);
          border-radius: 10px;
          border-left: 4px solid #ffc107;
          text-align: left;
          font-size: 13px;
          line-height: 1.6;
      }

      .file-rules h4 {
          color: #ffc107;
          margin-bottom: 8px;
          font-size: 14px;
      }

      .file-rules ul {
          list-style-type: none;
          padding-left: 0;
      }

      .file-rules li {
          margin-bottom: 5px;
          padding-left: 20px;
          position: relative;
      }

      .file-rules li:before {
          content: "â€¢";
          color: #ffc107;
          position: absolute;
          left: 0;
      }

      .controls { 
          display: flex; 
          justify-content: center; 
          align-items: center; 
          gap: 20px; 
          margin-bottom: 25px; 
          flex-wrap: wrap;
      }
      
      .date-display {
          padding: 15px 25px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border-radius: 30px;
          font-size: 16px;
          font-weight: 700;
          backdrop-filter: blur(10px);
          border: 3px solid rgba(255,255,255,0.3);
          box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
          text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }

      .btn { 
          padding: 15px 30px; 
          border: none; 
          border-radius: 30px; 
          cursor: pointer; 
          font-size: 16px; 
          font-weight: 700;
          transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
          backdrop-filter: blur(10px);
          position: relative;
          overflow: hidden;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
          border: 2px solid rgba(255,255,255,0.3);
      }

      .btn-primary { 
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white; 
          box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary { 
          background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
          color: white; 
          box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
      }

      .btn:hover {
          transform: translateY(-4px) scale(1.05);
          box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      }

      .receipt-wrapper {
          display: none;
          background: white;
          color: black;
          padding: 0px;
          margin-top: 30px;
          border-radius: 15px;
          width: 100%;
      }

      .receipt-wrapper.show {
          display: block;
      }

      .receipt-page { 
          width: 100%; 
          margin: 20px auto; 
          padding: 15mm; 
          background: white; 
          box-shadow: 0 15px 50px rgba(0,0,0,0.3);
          border-radius: 15px;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
      }

      .receipt { 
          border: 2px solid #333; 
          padding: 20px; 
          margin-bottom: 5mm;
          border-radius: 8px;
          background: #fafafa;
          width: 100%;
          max-width: none;
      }

      .receipt h2 { 
          text-align: center; 
          margin-bottom: 25px; 
          font-size: 24px; 
          color: #333;
          border-bottom: 3px solid #667eea; 
          padding-bottom: 12px; 
          font-weight: 700;
      }

      .receipt-info { 
          margin-bottom: 30px; 
      }
      
      .cut-line::before { 
          content: "âœ‚ï¸ ì ˆì·¨ì„ "; 
          position: absolute; 
          left: 50%; 
          top: -12px; 
          transform: translateX(-50%); 
          background: white; 
          padding: 0 20px; 
          color: #667eea;
          font-weight: 600;
          font-size: 14px;
      }

      .toast {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          background: #28a745;
          color: white;
          border-radius: 8px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          z-index: 10000;
          opacity: 0;
          transform: translateX(100%);
          transition: all 0.3s ease;
          font-weight: 600;
          max-width: 350px;
          word-wrap: break-word;
      }

      .toast.show {
          opacity: 1;
          transform: translateX(0);
      }

      .toast.error {
          background: #dc3545;
      }

      @media print {
    * {
        -webkit-print-color-adjust: exact !important;
        color-adjust: exact !important;
    }
    
    body {
        background: white !important;
        margin: 0 !important;
        padding: 0 !important;
        font-family: 'Malgun Gothic', sans-serif !important;
    }
    
    .container > *:not(.receipt-wrapper) {
        display: none !important;
    }
    
    .receipt-wrapper {
        display: block !important;
        background: white !important;
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
    }
    
    .receipt-page {
        width: 210mm !important;
        height: 297mm !important;
        margin: 0 !important;
        padding: 15mm !important;
        box-shadow: none !important;
        border-radius: 0 !important;
        background: white !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: flex-start !important;
        page-break-after: always !important;
        page-break-inside: avoid !important;
    }

    .receipt-page:last-child,
    .receipt-page.last-page {
        page-break-after: avoid !important;
    }
    
    .receipt {
        border: 2px solid #333 !important;
        padding: 15px !important;
        margin-bottom: 8mm !important;
        border-radius: 8px !important;
        background: #fafafa !important;
        width: 100% !important;
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
    }
    
    .receipt h2 {
        text-align: center !important;
        margin-bottom: 20px !important;
        font-size: 20px !important;
        color: #333 !important;
        border-bottom: 3px solid #667eea !important;
        padding-bottom: 10px !important;
        font-weight: 700 !important;
    }
    
    .receipt-info {
        margin-bottom: 25px !important;
        flex: 1 !important;
    }
    
    .receipt-info p {
        margin-bottom: 12px !important;
        font-size: 14px !important;
        display: flex !important;
        align-items: flex-start !important;
        gap: 8px !important;
    }
    
    .receipt-info strong {
        display: inline-block !important;
        width: 140px !important;
        color: #000000 !important;
        font-weight: 900 !important;
        background: #e8f4f8 !important;
        padding: 12px 6px !important;
        border-radius: 6px !important;
        flex-shrink: 0 !important;
        text-align: center !important;
        border: 1px solid #d1ecf1 !important;
        font-size: 14px !important;
    }
    
    .receipt-info .value {
        flex: 1 !important;
        padding: 10px 20px !important;
        background: white !important;
        border: 2px solid #e9ecef !important;
        border-radius: 6px !important;
        min-height: 12px !important;
        line-height: 1.4 !important;
        display: flex !important;
        align-items: center !important;
        font-size: 14px !important;
        font-weight: 700 !important;
        color: #000000 !important;
    }
    
    .signature-section {
        margin-top: 20px !important;
        border-top: 3px solid #667eea !important;
        padding-top: 20px !important;
    }
    
    .signature-row {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        margin-bottom: 15px !important;
        gap: 20px !important;
        flex-wrap: nowrap !important;
    }
    
    .signature-group {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 8px !important;
        flex: none !important;
        white-space: nowrap !important;
    }
    
    .signature-title {
        font-size: 16px !important;
        font-weight: 600 !important;
        color: #333 !important;
        white-space: nowrap !important;
        min-width: 60px !important;
    }
    
    .signature-line {
        border-bottom: 2px solid #333 !important;
        width: 120px !important;
        height: 25px !important;
        margin-left: 8px !important;
        flex-shrink: 0 !important;
    }
    
    .cut-line {
        border-top: 2px dashed #667eea !important;
        margin: 8mm auto !important;
        position: relative !important;
        text-align: center !important;
        width: 100% !important;
    }
    
    .cut-line::before {
        content: "âœ‚ï¸ ì ˆì·¨ì„ " !important;
        position: absolute !important;
        left: 50% !important;
        top: -10px !important;
        transform: translateX(-50%) !important;
        background: white !important;
        padding: 0 15px !important;
        color: #667eea !important;
        font-weight: 600 !important;
        font-size: 12px !important;
    }
}
 
  
    .receipt-info p {
        margin-bottom: 12px !important;
        font-size: 14px !important;
        display: flex !important;
        align-items: flex-start !important;
        gap: 8px !important;
    }
    
    .receipt-info strong {
        display: inline-block !important;
        width: 140px !important;
        color: #000000 !important;
        font-weight: 900 !important;
        background: #e8f4f8 !important;
        padding: 12px 6px !important;
        border-radius: 6px !important;
        flex-shrink: 0 !important;
        text-align: center !important;
        border: 1px solid #d1ecf1 !important;
        font-size: 14px !important;
    }
    
    .receipt-info .value {
        flex: 1 !important;
        padding: 10px 20px !important;
        background: white !important;
        border: 2px solid #e9ecef !important;
        border-radius: 6px !important;
        min-height: 12px !important;
        line-height: 1.4 !important;
        display: flex !important;
        align-items: center !important;
        font-size: 14px !important;
        font-weight: 700 !important;
        color: #000000 !important;
    }
    
    .signature-section {
        margin-top: 20px !important;
        border-top: 3px solid #667eea !important;
        padding-top: 20px !important;
    }
    
    .signature-row {
        display: flex !important;
        justify-content: left !important;
        align-items: center !important;
        margin-bottom: 15px !important;
        gap: 15px !important;
    }
    
    .signature-row[style*="center"] {
        justify-content: center !important;
    }
    
    .signature-group {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 8px !important;
    }
          
    .signature-line {
        border-bottom: 2px solid #333 !important;
        width: 120px !important;
        height: 25px !important;
        margin-left: 8px !important;
    }
    
    .cut-line {
        border-top: 2px dashed #667eea !important;
        margin: 8mm auto !important;
        position: relative !important;
        text-align: center !important;
        width: 100% !important;
    }
    
    .cut-line::before {
        content: "âœ‚ï¸ ì ˆì·¨ì„ " !important;
        position: absolute !important;
        left: 50% !important;
        top: -10px !important;
        transform: translateX(-50%) !important;
        background: white !important;
        padding: 0 15px !important;
        color: #667eea !important;
        font-weight: 600 !important;
        font-size: 12px !important;
    }
    
    /* í˜ì´ì§€ ì—¬ë°± ì„¤ì • */
    @page {
        size: A4 !important;
        margin: 10mm !important;
    }
}
  </style>
</head>
<body>
  <div class="container">
      <h1>ğŸ¢ LG CNS í†µí•© ë¬¼í’ˆê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
      
      <div class="mode-tabs">
          <div class="mode-tab active" data-mode="receipt">ğŸ“¤ íšŒìˆ˜í™•ì¸ì„œ</div>
          <div class="mode-tab" data-mode="delivery">ğŸ“¥ ì¸ìˆ˜í™•ì¸ì„œ</div>
      </div>

      <div class="upload-section">
          <h3>ğŸ“Š ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h3>
          <div class="file-input-wrapper">
              <input type="file" id="fileInput" accept=".xlsx,.xls" />
              <label for="fileInput" class="file-input-label">ğŸ“ íŒŒì¼ ì„ íƒ</label>
          </div>
          <div class="upload-info">ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</div>
          
          <div class="file-rules">
              <h4>ğŸ“‹ íŒŒì¼ ì—…ë¡œë“œ ê·œì¹™</h4>
              <ul id="fileRules">
                  <li>íšŒìˆ˜í™•ì¸ì„œ ëª¨ë“œ: "íšŒìˆ˜" ê´€ë ¨ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥</li>
                  <li>ì¸ìˆ˜í™•ì¸ì„œ ëª¨ë“œ: "ë‚©í’ˆ" ë˜ëŠ” "ì¸ìˆ˜" ê´€ë ¨ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥</li>
                  <li>íŒŒì¼ëª…ì— í•´ë‹¹ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤</li>
              </ul>
          </div>
      </div>

      <div class="controls">
          <div class="date-display">
              <span>ğŸ“… </span>
              <span id="currentDate">ë¡œë”©ì¤‘...</span>
          </div>
          <button class="btn btn-primary" onclick="generateReceipt()">ğŸ“‹ í™•ì¸ì„œ ìƒì„±</button>
          <button class="btn btn-secondary" onclick="printReceipt()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
      </div>

      <div class="receipt-wrapper" id="receiptWrapper">
          <div id="receiptContainer"></div>
      </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
      // ì „ì—­ ë³€ìˆ˜
      let currentMode = 'receipt';
      let excelData = [];

      // íŒŒì¼ëª… ê²€ì¦ ê·œì¹™
      const fileValidationRules = {
          receipt: {
              allowed: ['íšŒìˆ˜', 'íšŒìˆ˜ë¦¬ìŠ¤íŠ¸', 'íšŒìˆ˜ëª©ë¡', 'ë°˜ë‚©'],
              blocked: ['ë‚©í’ˆ', 'ìì‚°ë‚©í’ˆ', 'ì¸ìˆ˜', 'ë°°ì†¡', 'ì „ë‹¬'],
              message: 'íšŒìˆ˜í™•ì¸ì„œ ëª¨ë“œì—ì„œëŠ” "íšŒìˆ˜" ê´€ë ¨ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
          },
          delivery: {
              allowed: ['ë‚©í’ˆ', 'ìì‚°ë‚©í’ˆ', 'ì¸ìˆ˜', 'ë°°ì†¡', 'ì „ë‹¬', 'ì¸ìˆ˜ë¦¬ìŠ¤íŠ¸'],
              blocked: ['íšŒìˆ˜', 'íšŒìˆ˜ë¦¬ìŠ¤íŠ¸', 'ë°˜ë‚©'],
              message: 'ì¸ìˆ˜í™•ì¸ì„œ ëª¨ë“œì—ì„œëŠ” "ë‚©í’ˆ" ë˜ëŠ” "ì¸ìˆ˜" ê´€ë ¨ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
          }
      };

      // DOMì´ ë¡œë“œë˜ë©´ ì‹¤í–‰
      document.addEventListener('DOMContentLoaded', function() {
          console.log('ğŸš€ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');
          
          // ë‚ ì§œ ì—…ë°ì´íŠ¸ ì‹œì‘
          updateCurrentDate();
          setInterval(updateCurrentDate, 1000);
          
          // íŒŒì¼ ê·œì¹™ ì—…ë°ì´íŠ¸
          updateFileRules();
          
          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
          setupEventListeners();
          
          // ì´ˆê¸°í™” ì™„ë£Œ ì•Œë¦¼
          setTimeout(() => {
              showToast('âœ… ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
          }, 500);
      });

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      function setupEventListeners() {
          // ëª¨ë“œ íƒ­ í´ë¦­ ì´ë²¤íŠ¸
          document.querySelectorAll('.mode-tab').forEach(tab => {
              tab.addEventListener('click', function() {
                  const mode = this.getAttribute('data-mode');
                  switchMode(mode);
              });
          });

          // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸
          const fileInput = document.getElementById('fileInput');
          fileInput.addEventListener('change', handleFileUpload);
          
          console.log('âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
      }

      // í˜„ì¬ ë‚ ì§œ ì—…ë°ì´íŠ¸
      function updateCurrentDate() {
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          const seconds = String(now.getSeconds()).padStart(2, '0');
          
          const dateString = `${year}ë…„ ${month}ì›” ${day}ì¼ ${hours}:${minutes}:${seconds}`;
          
          const dateElement = document.getElementById('currentDate');
          if (dateElement) {
              dateElement.textContent = dateString;
          }
      }

      // íŒŒì¼ ê·œì¹™ ì—…ë°ì´íŠ¸
      function updateFileRules() {
          const rulesElement = document.getElementById('fileRules');
          const rules = fileValidationRules[currentMode];
          
          rulesElement.innerHTML = `
              <li><strong>${currentMode === 'receipt' ? 'íšŒìˆ˜í™•ì¸ì„œ' : 'ì¸ìˆ˜í™•ì¸ì„œ'} ëª¨ë“œ</strong></li>
              <li>í—ˆìš© í‚¤ì›Œë“œ: ${rules.allowed.join(', ')}</li>
              <li>ì°¨ë‹¨ í‚¤ì›Œë“œ: ${rules.blocked.join(', ')}</li>
              <li>íŒŒì¼ëª…ì— í—ˆìš© í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤</li>
          `;
      }

      // íŒŒì¼ëª… ê²€ì¦
      function validateFileName(fileName) {
          const rules = fileValidationRules[currentMode];
          const lowerFileName = fileName.toLowerCase();
          
          // ì°¨ë‹¨ëœ í‚¤ì›Œë“œ í™•ì¸
          for (let blocked of rules.blocked) {
              if (lowerFileName.includes(blocked.toLowerCase())) {
                  return {
                      valid: false,
                      message: `âŒ "${blocked}" í‚¤ì›Œë“œê°€ í¬í•¨ëœ íŒŒì¼ì€ í˜„ì¬ ëª¨ë“œì—ì„œ ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`
                  };
              }
          }
          
          // í—ˆìš©ëœ í‚¤ì›Œë“œ í™•ì¸
          let hasAllowedKeyword = false;
          for (let allowed of rules.allowed) {
              if (lowerFileName.includes(allowed.toLowerCase())) {
                  hasAllowedKeyword = true;
                  break;
              }
          }
          
          if (!hasAllowedKeyword) {
              return {
                  valid: false,
                  message: `âŒ í—ˆìš©ëœ í‚¤ì›Œë“œ(${rules.allowed.join(', ')})ê°€ íŒŒì¼ëª…ì— í¬í•¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`
              };
          }
          
          return { valid: true, message: 'âœ… íŒŒì¼ëª… ê²€ì¦ í†µê³¼' };
      }

      // ëª¨ë“œ ì „í™˜
      function switchMode(mode) {
          console.log('ğŸ”„ ëª¨ë“œ ì „í™˜:', mode);
          currentMode = mode;
          
          // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
          document.querySelectorAll('.mode-tab').forEach(tab => {
              tab.classList.remove('active');
          });
          document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

          // íŒŒì¼ ê·œì¹™ ì—…ë°ì´íŠ¸
          updateFileRules();

          // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
          excelData = [];
          document.getElementById('receiptWrapper').classList.remove('show');
          document.getElementById('fileInput').value = '';

          const modeText = mode === 'receipt' ? 'íšŒìˆ˜í™•ì¸ì„œ' : 'ì¸ìˆ˜í™•ì¸ì„œ';
          showToast(`${modeText} ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }

      // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
      function handleFileUpload(event) {
          console.log('ğŸ“ íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘');
          
          const file = event.target.files[0];
          if (!file) return;

          console.log('ì„ íƒëœ íŒŒì¼:', file.name);
          
          // íŒŒì¼ íƒ€ì… ê²€ì¦
          if (!file.name.match(/\.(xlsx|xls)$/i)) {
              showToast('âŒ ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
              event.target.value = '';
              return;
          }
          
          // íŒŒì¼ëª… ê²€ì¦
          const validation = validateFileName(file.name);
          if (!validation.valid) {
              showToast(validation.message, 'error');
              event.target.value = '';
              return;
          }

          showToast('ğŸ“„ íŒŒì¼ ê²€ì¦ ì™„ë£Œ. ì½ëŠ” ì¤‘...', 'success');

          const reader = new FileReader();
          
          reader.onload = function(e) {
              try {
                  const data = new Uint8Array(e.target.result);
                  const workbook = XLSX.read(data, { type: 'array' });
                  const firstSheetName = workbook.SheetNames[0];
                  const worksheet = workbook.Sheets[firstSheetName];
                  
                  excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                  
                  if (excelData.length > 1) {
                      const dataRows = excelData.length - 1;
                      showToast(`âœ… íŒŒì¼ ë¡œë“œ ì„±ê³µ! ${dataRows}ê°œ í•­ëª©`);
                  } else {
                      showToast('âŒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                  }
                  
              } catch (error) {
                  console.error('íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜:', error);
                  showToast('âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜', 'error');
              }
          };
          
          reader.readAsArrayBuffer(file);
      }

// í™•ì¸ì„œ ìƒì„±
function generateReceipt() {
    if (excelData.length === 0) {
        showToast('âŒ ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
        return;
    }

    const receiptWrapper = document.getElementById('receiptWrapper');
    const receiptContainer = document.getElementById('receiptContainer');
    
    let receiptsHTML = '';
    const currentDate = new Date().toLocaleDateString('ko-KR');
    
    // íšŒìˆ˜ì½”ë“œë³„ë¡œ ë°ì´í„° ê·¸ë£¹í™”
    const groupedData = {};
    
    // 6í–‰ë¶€í„° ë°ì´í„° ì‹œì‘ (0-based indexë¡œ 5ë¶€í„°)
    for (let i = 5; i < excelData.length; i++) {
        const row = excelData[i];
        if (row && row.length > 0) {
            // ì‹¤ì œ ìì‚° ë°ì´í„°ì¸ì§€ í™•ì¸ (ìì‚°ë²ˆí˜¸ê°€ ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ”ì§€ ì²´í¬)
            const assetNumber = row[0] ? String(row[0]).trim() : '';
            
            // ìì‚°ë²ˆí˜¸ê°€ ìˆ«ìë¡œ ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ ê±´ë„ˆë›°ê¸° (ì§€ì—­ëª… ë“± ì œì™¸)
            if (!assetNumber || !/^\d/.test(assetNumber)) {
                continue;
            }
            
            // ìˆ˜ê±°ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ê±´ë„ˆë›°ê¸°
            const collectionNumber = row[1] ? String(row[1]).trim() : '';
            if (!collectionNumber) {
                continue;
            }
            
            // ë°ì´í„° ì¶”ì¶œ
            const assetType = row[2] ? String(row[2]).trim() : '';  // Cì—´ - ìì‚°ë¶„ë¥˜
            const modelName = row[3] ? String(row[3]).trim() : '';  // Dì—´ - ëª¨ë¸ëª…
            const contactPerson = row[9] ? String(row[9]).trim() : '';  // Jì—´ - ì—°ë½ë“œë¦´ ë¶„
            const phoneNumber = row[10] ? String(row[10]).trim() : '';  // Kì—´ - ì „í™”ë²ˆí˜¸
            
            // íšŒìˆ˜ì½”ë“œë³„ë¡œ ê·¸ë£¹í™”
            if (!groupedData[collectionNumber]) {
                groupedData[collectionNumber] = {
                    assetNumbers: [],
                    assetItems: [],
                    contactPerson: contactPerson,
                    phoneNumber: phoneNumber
                };
            }
            
            // ìì‚°ë²ˆí˜¸ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
            if (!groupedData[collectionNumber].assetNumbers.includes(assetNumber)) {
                groupedData[collectionNumber].assetNumbers.push(assetNumber);
            }
            
            // ìì‚° í•­ëª© ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
            const assetItem = `${assetType} ${modelName}`.trim();
            if (assetItem && !groupedData[collectionNumber].assetItems.includes(assetItem)) {
                groupedData[collectionNumber].assetItems.push(assetItem);
            }
        }
    }
    
    // ê·¸ë£¹í™”ëœ ë°ì´í„°ë¡œ í™•ì¸ì„œ ìƒì„±
    Object.keys(groupedData).forEach(collectionNumber => {
        const data = groupedData[collectionNumber];
        
        const receiptTitle = currentMode === 'receipt' ? 'LG CNS íšŒìˆ˜ í™•ì¸ì„œ' : 'ë¬¼í’ˆ ì¸ìˆ˜ í™•ì¸ì„œ';
        const actionText = currentMode === 'receipt' ? 'íšŒìˆ˜' : 'ì¸ìˆ˜';
        
        // ìì‚°ë²ˆí˜¸ë“¤ì„ ì½¤ë§ˆë¡œ ì—°ê²°
        const assetNumbers = data.assetNumbers.join(', ');
        
        // ìì‚° í•­ëª©ë“¤ì„ ì½¤ë§ˆë¡œ ì—°ê²°
        const assetList = data.assetItems.join(', ');
        
        // ì—°ë½ì²˜ ì •ë³´
        const returnPersonInfo = `${data.contactPerson} ${data.phoneNumber}`.trim();
        
        // ê¸°ì¡´ ì½”ë“œë¥¼ ì°¾ì•„ì„œ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •
receiptsHTML += `
    <div class="receipt-page">
        <div class="receipt">
            <h2>${receiptTitle}(íšŒìˆ˜ì)</h2>
            <div class="receipt-info">
                <p><strong>ìì‚°ë²ˆí˜¸</strong><span class="value">${assetNumbers}</span></p>
                <p><strong>íšŒìˆ˜ì½”ë“œ</strong><span class="value">${collectionNumber}</span></p>
                <p><strong>ë°˜ë‚©ìì‚°ëª©ë¡</strong><span class="value">${assetList}</span></p>
                <p><strong>ë°˜ë‚©ìì •ë³´</strong><span class="value">${returnPersonInfo}</span></p>
                <p><strong>íšŒìˆ˜ì¼ì</strong><span class="value">${currentDate}</span></p>
            </div>
            <div class="signature-section">
                <div class="signature-row" style="justify-content: center !important;">
                    <div class="signature-group">
                        <span class="signature-title">íšŒìˆ˜ì :</span>
                        <div class="signature-line"></div>
                        <span style="margin-left: 10px;">ì¸</span>
                    </div>
                    <div class="signature-group" style="margin-left: 10px;">
                        <span class="signature-title">ë°˜ë‚©ì :</span>
                        <div class="signature-line"></div>
                        <span style="margin-left: 10px;">ì¸</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="cut-line"></div>
        <div class="receipt">
    <h2>${receiptTitle}(ë°˜ë‚©ì)</h2>
    <div class="receipt-info">
        <p><strong>ìì‚°ë²ˆí˜¸</strong><span class="value">${assetNumbers}</span></p>
        <p><strong>íšŒìˆ˜ì½”ë“œ</strong><span class="value">${collectionNumber}</span></p>
        <p><strong>ë°˜ë‚©ìì‚°ëª©ë¡</strong><span class="value">${assetList}</span></p>
        <p><strong>ë°˜ë‚©ìì •ë³´</strong><span class="value">${returnPersonInfo}</span></p>
        <p><strong>íšŒìˆ˜ì¼ì</strong><span class="value">${currentDate}</span></p>
    </div>
    <div class="signature-section">
        <div class="signature-row" style="justify-content: center !important;">
            <div class="signature-group">
                <span class="signature-title">íšŒìˆ˜ì :</span>
                <div class="signature-line"></div>
                <span style="margin-left: 10px;">ì¸</span>
            </div>
        </div>
    </div>
</div>
    </div>
`;
    });
    
    receiptContainer.innerHTML = receiptsHTML;

// ë§ˆì§€ë§‰ receipt-pageì— í´ë˜ìŠ¤ ì¶”ê°€
const allPages = receiptContainer.querySelectorAll('.receipt-page');
if (allPages.length > 0) {
    allPages[allPages.length - 1].classList.add('last-page');
}

receiptWrapper.classList.add('show');

showToast('âœ… í™•ì¸ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');

}

      // ì¸ì‡„í•˜ê¸°
      function printReceipt() {
          if (!document.getElementById('receiptWrapper').classList.contains('show')) {
              showToast('âŒ ë¨¼ì € í™•ì¸ì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
              return;
          }
          
          window.print();
      }

      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
      function showToast(message, type = 'success') {
          const toast = document.getElementById('toast');
          toast.textContent = message;
          toast.className = `toast ${type}`;
          
          // í‘œì‹œ
          setTimeout(() => {
              toast.classList.add('show');
          }, 100);
          
          // ìˆ¨ê¸°ê¸°
          setTimeout(() => {
              toast.classList.remove('show');
          }, 3000);
      }
  </script>
</body>
</html>
